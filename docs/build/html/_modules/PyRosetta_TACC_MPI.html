
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>PyRosetta_TACC_MPI &#8212; Bioinfo Nats 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for PyRosetta_TACC_MPI</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>
<span class="c1"># from rosetta import *</span>
<span class="kn">import</span> <span class="nn">pyrosetta</span>
<span class="kn">from</span> <span class="nn">pyrosetta.rosetta.core</span> <span class="k">import</span> <span class="n">conformation</span>
<span class="kn">from</span> <span class="nn">pyrosetta.rosetta.core</span> <span class="k">import</span> <span class="n">chemical</span>
<span class="kn">from</span> <span class="nn">pyrosetta.mpi</span> <span class="k">import</span> <span class="n">mpi_init</span>

<span class="n">nAAs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ALA&#39;</span><span class="p">,</span> <span class="s1">&#39;ASP&#39;</span><span class="p">,</span> <span class="s1">&#39;LEU&#39;</span><span class="p">,</span> <span class="s1">&#39;ILE&#39;</span><span class="p">,</span> <span class="s1">&#39;VAL&#39;</span><span class="p">,</span> <span class="s1">&#39;GLY&#39;</span><span class="p">,</span> <span class="s1">&#39;SER&#39;</span><span class="p">,</span> <span class="s1">&#39;THR&#39;</span><span class="p">,</span> <span class="s1">&#39;PRO&#39;</span><span class="p">,</span> <span class="s1">&#39;GLU&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">,</span> <span class="s1">&#39;GLN&#39;</span><span class="p">,</span> <span class="s1">&#39;LYS&#39;</span><span class="p">,</span> <span class="s1">&#39;ARG&#39;</span><span class="p">,</span> <span class="s1">&#39;TRP&#39;</span><span class="p">,</span> <span class="s1">&#39;PHE&#39;</span><span class="p">,</span>
        <span class="s1">&#39;TYR&#39;</span><span class="p">,</span> <span class="s1">&#39;HIS&#39;</span><span class="p">,</span> <span class="s1">&#39;CYS&#39;</span><span class="p">,</span> <span class="s1">&#39;MET&#39;</span><span class="p">]</span>
<span class="n">nsAAs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;PRK&#39;</span><span class="p">,</span> <span class="s1">&#39;ACK&#39;</span><span class="p">,</span> <span class="s1">&#39;3IY&#39;</span><span class="p">,</span> <span class="s1">&#39;NOY&#39;</span><span class="p">,</span> <span class="s1">&#39;AZF&#39;</span><span class="p">,</span> <span class="s1">&#39;A69&#39;</span><span class="p">,</span> <span class="s1">&#39;B36&#39;</span><span class="p">,</span> <span class="s1">&#39;NBY&#39;</span><span class="p">,</span> <span class="s1">&#39;PHS&#39;</span><span class="p">,</span> <span class="s1">&#39;PHT&#39;</span><span class="p">,</span> <span class="s1">&#39;PHY&#39;</span><span class="p">,</span> <span class="s1">&#39;SOY&#39;</span><span class="p">,</span> <span class="s1">&#39;MMD&#39;</span><span class="p">,</span> <span class="s1">&#39;MMS&#39;</span><span class="p">,</span> <span class="s1">&#39;MMY&#39;</span><span class="p">,</span>
         <span class="s1">&#39;MMK&#39;</span><span class="p">]</span>  <span class="c1"># A69 = 3-aminotyrosine, B36 = 5-hydroxytryptophan</span>

<span class="n">NSAAS_PATCH</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Need to get rid of refs to this in code</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&#39;ACK&#39;:{&#39;cognateAA&#39;:&#39;LYS&#39;,</span>
<span class="sd">&#39;type&#39;:chemical.VariantType.ACETYLATION},</span>
<span class="sd">&#39;PHS&#39;:{&#39;cognateAA&#39;:&#39;SER&#39;,</span>
<span class="sd">&#39;type&#39;:chemical.VariantType.PHOSPHORYLATION},</span>
<span class="sd">&#39;PHT&#39;:{&#39;cognateAA&#39;:&#39;THR&#39;,</span>
<span class="sd">&#39;type&#39;:chemical.VariantType.PHOSPHORYLATION},</span>
<span class="sd">&#39;PHY&#39;:{&#39;cognateAA&#39;:&#39;TYR&#39;,</span>
<span class="sd">&#39;type&#39;:chemical.VariantType.PHOSPHORYLATION}}</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># =========================================================================</span>
<span class="c1">#</span>
<span class="c1"># ABSTRACT CLASSES - DO NOT call directly!</span>
<span class="c1">#</span>
<span class="c1"># =========================================================================</span>


<div class="viewcode-block" id="AbstractExperimentRunner"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner">[docs]</a><span class="k">class</span> <span class="nc">AbstractExperimentRunner</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span> <span class="n">rosetta_init_options</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="p">,</span> <span class="n">max_pack_rounds</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="p">,</span>
                 <span class="n">min_restrict_radius</span><span class="p">,</span> <span class="n">PDB_res</span><span class="p">,</span> <span class="n">dump_ref_pdb</span><span class="p">,</span> <span class="n">dump_mut_pdb</span><span class="p">,</span> <span class="n">pdb_base</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="n">constraint_file</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;AbstractExperimentRunner __init__(): restrict_to_chain= </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">restrict_to_chain</span><span class="p">),)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdbs</span> <span class="o">=</span> <span class="n">start_pose_pdbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rosetta_init_options</span> <span class="o">=</span> <span class="n">rosetta_init_options</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_pack_rounds</span> <span class="o">=</span> <span class="n">max_pack_rounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span> <span class="o">=</span> <span class="n">restrict_to_chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_res</span> <span class="o">=</span> <span class="n">PDB_res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span> <span class="o">=</span> <span class="n">min_cst_sd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span> <span class="o">=</span> <span class="n">min_restrict_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_ref_pdb</span> <span class="o">=</span> <span class="n">dump_ref_pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_mut_pdb</span> <span class="o">=</span> <span class="n">dump_mut_pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_base</span> <span class="o">=</span> <span class="n">pdb_base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span> <span class="o">=</span> <span class="n">constraint_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="AbstractExperimentRunner.setup_MPI"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner.setup_MPI">[docs]</a>    <span class="k">def</span> <span class="nf">setup_MPI</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comm</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">comm</span><span class="p">:</span>
            <span class="n">pyrosetta</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">extra_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rosetta_init_options</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comm</span> <span class="o">=</span> <span class="n">comm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_size</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">comm</span><span class="o">.</span><span class="n">Get_rank</span><span class="p">()</span>
            <span class="c1"># keep a list of Job objects</span>
            <span class="n">mpi_init</span><span class="p">(</span><span class="n">extra_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rosetta_init_options</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractExperimentRunner.scatter_job"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner.scatter_job">[docs]</a>    <span class="k">def</span> <span class="nf">scatter_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">local_jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">job_spec</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">local_jobs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;===== Process </span><span class="si">%d</span><span class="s2">, running job </span><span class="si">%s</span><span class="s2"> [ </span><span class="si">%d</span><span class="s2"> / </span><span class="si">%d</span><span class="s2"> ]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_spec</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">local_jobs</span><span class="p">)))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ddg_job</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packer_job_class</span><span class="p">(</span><span class="o">*</span><span class="n">job_spec</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pack_rounds</span><span class="p">,</span>
                                                <span class="n">restrict_to_chain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">,</span>
                                                <span class="n">min_restrict_radius</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_res</span><span class="p">,</span>
                                                <span class="n">min_cst_sd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">,</span>
                                                <span class="n">constraint_file</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>

                <span class="n">ddg_job</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddg_job</span><span class="o">.</span><span class="n">get_result</span><span class="p">())</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_ref_pdb</span><span class="p">:</span>
                    <span class="n">ddg_job</span><span class="o">.</span><span class="n">dump_ref_pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_base</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ddg_job</span><span class="o">.</span><span class="n">start_pose_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">job_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="o">+</span> <span class="s2">&quot;_ref.pdb&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_mut_pdb</span><span class="p">:</span>
                    <span class="n">start_pose_idx</span> <span class="o">=</span> <span class="s2">&quot;p&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdbs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">job_spec</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="n">ddg_job</span><span class="o">.</span><span class="n">dump_mut_pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_base</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ddg_job</span><span class="o">.</span><span class="n">start_pose_name</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">job_spec</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span> <span class="o">+</span> <span class="s2">&quot;_mut.pdb&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;****WARNING: RUNTIME ERROR IN PROCESS </span><span class="si">%d</span><span class="s2"> JOB </span><span class="si">%s</span><span class="s2">; ABORTING RUN [ERROR:</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_spec</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">PyRosettaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;****WARNING: PYROSETTA ERROR IN PROCESS </span><span class="si">%d</span><span class="s2"> JOB </span><span class="si">%s</span><span class="s2">; SKIPPING JOB [ERROR:</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_spec</span><span class="p">),</span> <span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractExperimentRunner.gather_results"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner.gather_results">[docs]</a>    <span class="k">def</span> <span class="nf">gather_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">comm</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractExperimentRunner.run_all_jobs_serial"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner.run_all_jobs_serial">[docs]</a>    <span class="k">def</span> <span class="nf">run_all_jobs_serial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="o">=</span><span class="s1">&#39;ddg_out.txt&#39;</span><span class="p">):</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">job_spec</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jobs</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;===== Process </span><span class="si">%d</span><span class="s2">, running job </span><span class="si">%s</span><span class="s2"> [ </span><span class="si">%d</span><span class="s2"> / </span><span class="si">%d</span><span class="s2"> ]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_spec</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">local_jobs</span><span class="p">)))</span>
            <span class="n">ddg_job</span> <span class="o">=</span> <span class="n">MutantddGPackerJob</span><span class="p">(</span><span class="o">*</span><span class="n">job_spec</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_pack_rounds</span><span class="p">,</span>
                                         <span class="n">restrict_to_chain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pdb_res</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ddg_job</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
                <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;****WARNING: RUNTIME ERROR IN PROCESS </span><span class="si">%d</span><span class="s2"> JOB: </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">; SKIPPING JOB&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">job_spec</span><span class="p">),</span> <span class="n">ddg_job</span><span class="o">.</span><span class="n">repr_str</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ddg_job</span><span class="o">.</span><span class="n">get_result</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_ddg_results</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractExperimentRunner.dump_ddg_results"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractExperimentRunner.dump_ddg_results">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ddg_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specification Required!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="AbstractPackerJob"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob">[docs]</a><span class="k">class</span> <span class="nc">AbstractPackerJob</span><span class="p">():</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">conv_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repack_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorefn</span><span class="o">=</span><span class="s2">&quot;mm_std&quot;</span><span class="p">,</span>
                 <span class="n">mintype</span><span class="o">=</span><span class="s2">&quot;dfpmin_armijo_nonmonotone&quot;</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">convergence_fn</span> <span class="o">=</span> <span class="n">convergence_fn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv_threshold</span> <span class="o">=</span> <span class="n">conv_threshold</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">convergence_fn</span> <span class="ow">or</span> <span class="n">convergence_fn</span> <span class="o">==</span> <span class="s1">&#39;stdev&#39;</span><span class="p">:</span>  <span class="c1"># defaults to stdev for now, may add more later</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">std_dev_threshold_fn_builder</span><span class="p">(</span><span class="n">conv_threshold</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_rounds</span> <span class="o">=</span> <span class="n">max_rounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repack_radius</span> <span class="o">=</span> <span class="n">repack_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mintype</span> <span class="o">=</span> <span class="n">mintype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span> <span class="o">=</span> <span class="n">restrict_to_chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>
        <span class="c1"># a PyRosetta ScoreFunction object, defaults to mm_std</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">create_score_function</span><span class="p">(</span><span class="n">scorefn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span> <span class="o">=</span> <span class="n">constraint_file</span>

<div class="viewcode-block" id="AbstractPackerJob.mutate_aa"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.mutate_aa">[docs]</a>    <span class="k">def</span> <span class="nf">mutate_aa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">aa_name</span><span class="p">,</span> <span class="n">orient_bb</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">repack_sidechain</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">clone_pose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Swap w/t AA at residue number &#39;residue&#39; in &#39;pose&#39; with &#39;ncaa_name&#39; (3-letter code)</span>

<span class="sd">        Return a new Pose object</span>

<span class="sd">        Note that this assumes the ncaa .params and .rotlib files have been permanently added to the database</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mut_pose</span> <span class="o">=</span> <span class="n">pose</span>
        <span class="k">if</span> <span class="n">clone_pose</span><span class="p">:</span>
            <span class="n">mut_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
            <span class="n">mut_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">mut_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span>
        <span class="n">ref_res_name</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
        <span class="c1"># check for disulfides and correct if needed</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CYS:disulfide&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">name</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;CYD&#39;</span><span class="p">):</span>
            <span class="n">disulfide_partner</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">disulfide_partner</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">residue_connection_partner</span><span class="p">(</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">n_residue_connections</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">disulfide_partner</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">residue_connection_partner</span><span class="p">(</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">n_current_residue_connections</span><span class="p">())</span>
            <span class="n">temp_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
            <span class="n">temp_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="c1"># (Packing causes seg fault if current CYS residue is not</span>
            <span class="c1"># also converted before mutating.)</span>
            <span class="n">conformation</span><span class="o">.</span><span class="n">change_cys_state</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="s1">&#39;CYS&#39;</span><span class="p">,</span>
                                          <span class="n">temp_pose</span><span class="o">.</span><span class="n">conformation</span><span class="p">())</span>
            <span class="n">conformation</span><span class="o">.</span><span class="n">change_cys_state</span><span class="p">(</span><span class="n">disulfide_partner</span><span class="p">,</span> <span class="s1">&#39;CYS&#39;</span><span class="p">,</span>
                                          <span class="n">temp_pose</span><span class="o">.</span><span class="n">conformation</span><span class="p">())</span>
            <span class="n">mut_pose</span> <span class="o">=</span> <span class="n">temp_pose</span>

            <span class="c1"># Get a Residue object for the desired ncAA</span>
        <span class="n">mut_res_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">rts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">chm</span> <span class="o">=</span> <span class="n">chemical</span><span class="o">.</span><span class="n">ChemicalManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">rts</span> <span class="o">=</span> <span class="n">chm</span><span class="o">.</span><span class="n">residue_type_set</span><span class="p">(</span><span class="s2">&quot;fa_standard&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="c1"># older versions of PyRosetta (e.g. the TACC stampede install of 3.4)</span>
            <span class="c1"># have a slightly different call to get the residue_type_set object:</span>
            <span class="n">rts</span> <span class="o">=</span> <span class="n">chm</span><span class="o">.</span><span class="n">residue_type_set</span><span class="p">(</span><span class="s2">&quot;fa_standard&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">aa_name</span> <span class="ow">in</span> <span class="n">NSAAS_PATCH</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1"># PTMs and nsAAs using the patch system need to be treated differently</span>
            <span class="c1"># for TACC PyRosett install; don&#39;t know if this will work with newer versions</span>
            <span class="c1"># where VariantType enumerator class can be called direct</span>
            <span class="n">cognate_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">name_map</span><span class="p">(</span><span class="n">NSAAS_PATCH</span><span class="p">[</span><span class="n">aa_name</span><span class="p">][</span><span class="s1">&#39;cognateAA&#39;</span><span class="p">])</span>
            <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">get_residue_type_with_variant_added</span><span class="p">(</span><span class="n">cognate_res_type</span><span class="p">,</span> <span class="n">NSAAS_PATCH</span><span class="p">[</span><span class="n">aa_name</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># replace the target residue with the ncAA</span>
            <span class="c1"># if residue == 1 or residue == mut_pose.total_residue():</span>
            <span class="c1">#    aa_name = aa_name + &quot;_p&quot;</span>
            <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">name_map</span><span class="p">(</span><span class="n">aa_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">residue</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">get_residue_type_with_variant_added</span><span class="p">(</span><span class="n">mut_res_type</span><span class="p">,</span>
                                                                       <span class="n">chemical</span><span class="o">.</span><span class="n">VariantType</span><span class="o">.</span><span class="n">LOWER_TERMINUS_VARIANT</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">get_residue_type_with_variant_added</span><span class="p">(</span><span class="n">mut_res_type</span><span class="p">,</span> <span class="s2">&quot;LOWER_TERMINUS&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">residue</span> <span class="o">==</span> <span class="n">mut_pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">get_residue_type_with_variant_added</span><span class="p">(</span><span class="n">mut_res_type</span><span class="p">,</span>
                                                                       <span class="n">chemical</span><span class="o">.</span><span class="n">VariantType</span><span class="o">.</span><span class="n">UPPER_TERMINUS_VARIANT</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">mut_res_type</span> <span class="o">=</span> <span class="n">rts</span><span class="o">.</span><span class="n">get_residue_type_with_variant_added</span><span class="p">(</span><span class="n">mut_res_type</span><span class="p">,</span> <span class="s2">&quot;UPPER_TERMINUS&quot;</span><span class="p">)</span>
        <span class="n">mut_res</span> <span class="o">=</span> <span class="n">conformation</span><span class="o">.</span><span class="n">ResidueFactory</span><span class="o">.</span><span class="n">create_residue</span><span class="p">(</span><span class="n">mut_res_type</span><span class="p">)</span>
        <span class="n">mut_pose</span><span class="o">.</span><span class="n">replace_residue</span><span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">mut_res</span><span class="p">,</span> <span class="n">orient_backbone</span><span class="o">=</span><span class="n">orient_bb</span><span class="p">)</span>

        <span class="c1"># Highly recommended to repack the sidechain after calling Pose.replace_residue()...otherwise</span>
        <span class="c1"># later packing steps get caught in weird local minima :&#39;(</span>
        <span class="c1"># tmp_verbose = self.verbose</span>
        <span class="c1"># self.verbose=2</span>
        <span class="k">if</span> <span class="n">repack_sidechain</span><span class="p">:</span>
            <span class="c1"># annoying but apparently has to be done this way?...</span>
            <span class="n">repack_task</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">TaskFactory</span><span class="o">.</span><span class="n">create_packer_task</span><span class="p">(</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="n">repack_task</span><span class="o">.</span><span class="n">restrict_to_repacking</span><span class="p">()</span>
            <span class="n">repack_res_list</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">vector1_bool</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mut_pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">repack_res_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">residue</span><span class="p">)</span>
            <span class="n">repack_task</span><span class="o">.</span><span class="n">restrict_to_residues</span><span class="p">(</span><span class="n">repack_res_list</span><span class="p">)</span>
            <span class="n">sidechain_PackRotamersMover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span>
                                                                                                     <span class="n">repack_task</span><span class="p">)</span>

            <span class="n">initial_mut_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Packer task:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="n">repack_task</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Repacking mutated sidechain </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> -&gt; </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">mut_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">pose2pdb</span><span class="p">(</span><span class="n">residue</span><span class="p">),</span> <span class="n">ref_res_name</span><span class="p">,</span> <span class="n">aa_name</span><span class="p">),)</span>
            <span class="n">sidechain_PackRotamersMover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="n">repacked_mut_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;initial E = </span><span class="si">%f</span><span class="s2"> repacked E = </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">initial_mut_score</span><span class="p">,</span> <span class="n">repacked_mut_score</span><span class="p">))</span>
        <span class="c1"># self.verbose=tmp_verbose</span>

        <span class="k">return</span> <span class="n">mut_pose</span></div>

<div class="viewcode-block" id="AbstractPackerJob.packer_task_repack_in_radius"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.packer_task_repack_in_radius">[docs]</a>    <span class="k">def</span> <span class="nf">packer_task_repack_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a packer task that repacks all residues with CAlphas within distance radius</span>

<span class="sd">        Might want to remake to take centroid side-chains?  Looks like SwitchResidueTypeMover has trouble w/ nsAAs...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pack_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_CAs_in_radius</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">radius</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_packer_task_with_residues</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">pack_residues</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractPackerJob.make_packer_task_with_residues"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.make_packer_task_with_residues">[docs]</a>    <span class="k">def</span> <span class="nf">make_packer_task_with_residues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">residues</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Builds a packer task with the specified residues activated for repacking.</span>

<span class="sd">        Did this to avoid PackerTask.temporarily_* methods which apparently we&#39;re not supposed to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">packer_task</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">pack</span><span class="o">.</span><span class="n">task</span><span class="o">.</span><span class="n">TaskFactory</span><span class="o">.</span><span class="n">create_packer_task</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>
        <span class="n">packer_task</span><span class="o">.</span><span class="n">restrict_to_repacking</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="n">residues</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">residues</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Vector1 doesn&#39;t translate booleans correctly in</span>
            <span class="c1"># TACC version of PyRosetta; need to build utility.vector1_bool() directly</span>
            <span class="c1"># pack_residues = Vector1([x in residues for x in range(1,pose.total_residue())])</span>
            <span class="n">pack_residues</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">utility</span><span class="o">.</span><span class="n">vector1_bool</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># print (i,i in residues)</span>
                    <span class="n">pack_residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">)</span>
            <span class="n">packer_task</span><span class="o">.</span><span class="n">restrict_to_residues</span><span class="p">(</span><span class="n">pack_residues</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">packer_task</span></div>

<div class="viewcode-block" id="AbstractPackerJob.residue_CAs_in_radius"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.residue_CAs_in_radius">[docs]</a>    <span class="k">def</span> <span class="nf">residue_CAs_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">centerAA</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of residues with C-alpha atoms within &#39;radius&#39; distance from centerAA&#39;a C-alpha</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centerAA_CA</span> <span class="o">=</span> <span class="n">pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">centerAA</span><span class="p">)</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">)</span>
        <span class="n">repack_residues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;residue_CA_in_radius: centerAA=</span><span class="si">%d</span><span class="s2">, restrict_to_chain=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">centerAA</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()):</span>
            <span class="c1"># This is a little fudgy since restrict_to_chain could be either a list or a string depending on the calling child class</span>
            <span class="c1">#</span>
            <span class="c1"># Note that this may break if chains are not single characters</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">test_CA</span> <span class="o">=</span> <span class="n">pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">)</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">centerAA_CA</span> <span class="o">-</span> <span class="n">test_CA</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">displacement</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">:</span>
                <span class="n">repack_residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">repack_residues</span></div>

<div class="viewcode-block" id="AbstractPackerJob.make_CompoundMover"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.make_CompoundMover">[docs]</a>    <span class="k">def</span> <span class="nf">make_CompoundMover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movers</span><span class="p">,</span> <span class="n">repeats_per_round</span><span class="p">):</span>

        <span class="k">class</span> <span class="nc">CompoundMover</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movers</span><span class="p">,</span> <span class="n">repeats</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">movers</span> <span class="o">=</span> <span class="n">movers</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span> <span class="o">=</span> <span class="n">repeats</span>

            <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">mv</span><span class="p">,</span> <span class="n">reps</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">movers</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeats</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">reps</span><span class="p">):</span>
                        <span class="n">mv</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">CompoundMover</span><span class="p">(</span><span class="n">movers</span><span class="p">,</span> <span class="n">repeats_per_round</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractPackerJob.make_packmin_mover"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.make_packmin_mover">[docs]</a>    <span class="k">def</span> <span class="nf">make_packmin_mover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">packertask</span><span class="p">,</span> <span class="n">minmover</span><span class="p">,</span> <span class="n">n_packing_steps</span><span class="p">,</span> <span class="n">n_minimize_steps</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build a TrialMover with n_packing_steps RotamerTrialMover moves and</span>
<span class="sd">            n_minimization_steps MinMover moves executed sequentially</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">seqmover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">SequenceMover</span><span class="p">()</span>
        <span class="n">packmover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span> <span class="n">packertask</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_packing_steps</span><span class="p">):</span>
            <span class="c1"># pack_repmover = rosetta.RepeatMover(packmover,n_packing_steps)</span>
            <span class="n">seqmover</span><span class="o">.</span><span class="n">add_mover</span><span class="p">(</span><span class="n">packmover</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_minimize_steps</span><span class="p">):</span>
            <span class="c1"># min_repmover = rosetta.RepeatMover(minmover,n_minimize_steps)</span>
            <span class="n">seqmover</span><span class="o">.</span><span class="n">add_mover</span><span class="p">(</span><span class="n">minmover</span><span class="p">)</span>

        <span class="c1"># print &gt;&gt; sys.stderr, seqmover</span>

        <span class="n">mc</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">MonteCarlo</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span> <span class="n">kT</span><span class="p">)</span>
        <span class="n">packmin_trial_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">moves</span><span class="o">.</span><span class="n">TrialMover</span><span class="p">(</span><span class="n">seqmover</span><span class="p">,</span> <span class="n">mc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">seqmover</span></div>

<div class="viewcode-block" id="AbstractPackerJob.std_dev_threshold_fn_builder"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.std_dev_threshold_fn_builder">[docs]</a>    <span class="k">def</span> <span class="nf">std_dev_threshold_fn_builder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">last_n</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>
            <span class="n">passed</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">last_n</span><span class="p">:</span>
                <span class="n">last_n_stdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="n">last_n</span><span class="p">:])</span>
                <span class="n">passed</span> <span class="o">=</span> <span class="n">last_n_stdev</span> <span class="o">&lt;</span> <span class="n">threshold</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;std dev for scores </span><span class="si">%s</span><span class="s2">: </span><span class="si">%f</span><span class="s2"> thresh: </span><span class="si">%f</span><span class="s2"> pass?: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="n">last_n</span><span class="p">:]),</span> <span class="n">last_n_stdev</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">passed</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">passed</span>

        <span class="k">return</span> <span class="n">stop</span></div>

<div class="viewcode-block" id="AbstractPackerJob.build_movemap"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.build_movemap">[docs]</a>    <span class="k">def</span> <span class="nf">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">restrict_radius_center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restrict_residues</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">restrict_radius</span><span class="p">:</span>
            <span class="n">restrict_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">repack_radius</span>
        <span class="n">mm</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">kinematics</span><span class="o">.</span><span class="n">MoveMap</span><span class="p">()</span>
        <span class="n">mm</span><span class="o">.</span><span class="n">set_bb</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mm</span><span class="o">.</span><span class="n">set_chi</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mm</span><span class="o">.</span><span class="n">set_jump</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">residues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restrict_to_chain</span><span class="p">:</span>
                    <span class="n">residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">restrict_radius_center</span><span class="p">:</span>
            <span class="n">possible_residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_CAs_in_radius</span><span class="p">(</span><span class="n">pose</span><span class="p">,</span> <span class="n">restrict_radius_center</span><span class="p">,</span> <span class="n">restrict_radius</span><span class="p">)</span>
            <span class="n">restricted_residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">possible_residues</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">resiudes</span><span class="p">]</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="n">restricted_residues</span>
        <span class="k">elif</span> <span class="n">restrict_residues</span><span class="p">:</span>
            <span class="n">restricted_residues</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">restrict_residues</span> <span class="k">if</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">]</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="n">restricted_residues</span>

        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
            <span class="n">mm</span><span class="o">.</span><span class="n">set_bb</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="n">mm</span><span class="o">.</span><span class="n">set_chi</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mm</span></div>

<div class="viewcode-block" id="AbstractPackerJob.make_minmover"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.make_minmover">[docs]</a>    <span class="k">def</span> <span class="nf">make_minmover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mintype</span><span class="p">,</span> <span class="n">movemap</span><span class="p">,</span> <span class="n">pose</span><span class="p">):</span>
        <span class="c1"># Set up a Minimization mover using the mm_std score function</span>
        <span class="n">min_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">MinMover</span><span class="p">()</span>
        <span class="n">min_mover</span><span class="o">.</span><span class="n">movemap</span><span class="p">(</span><span class="n">movemap</span><span class="p">)</span>
        <span class="n">min_scorefn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">:</span>
            <span class="n">min_scorefn</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">coordinate_constraint</span><span class="p">,</span>
                                   <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># arbitrary weight for now</span>
        <span class="n">min_mover</span><span class="o">.</span><span class="n">score_function</span><span class="p">(</span><span class="n">min_scorefn</span><span class="p">)</span>
        <span class="n">min_mover</span><span class="o">.</span><span class="n">min_type</span><span class="p">(</span><span class="n">mintype</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">min_mover</span></div>

<div class="viewcode-block" id="AbstractPackerJob.add_constraints_to_scorefxn"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.add_constraints_to_scorefxn">[docs]</a>    <span class="k">def</span> <span class="nf">add_constraints_to_scorefxn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_weight</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">constraint_types</span><span class="p">:</span>
            <span class="n">constraint_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">atom_pair_constraint</span><span class="p">,</span>
                                <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">angle_constraint</span><span class="p">,</span>
                                <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">dihedral_constraint</span><span class="p">,</span>
                                <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">coordinate_constraint</span><span class="p">,</span>
                                <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">constant_constraint</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">default_weight</span><span class="p">,</span> <span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">constraint_types</span><span class="p">)</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">constraint_types</span><span class="p">,</span> <span class="n">weights</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="o">.</span><span class="n">get_weight</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="o">.</span><span class="n">set_weight</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span></div>

<div class="viewcode-block" id="AbstractPackerJob.add_constraints_to_pose"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.AbstractPackerJob.add_constraints_to_pose">[docs]</a>    <span class="k">def</span> <span class="nf">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pose</span><span class="p">,</span> <span class="n">constraint_file</span><span class="p">):</span>
        <span class="c1"># Still not sure how to implement this in PyRosetta4 ?</span>
        <span class="c1"># setup = rosetta.ConstraintSetMover()</span>
        <span class="c1"># setup.constraint_file(constraint_file)</span>
        <span class="c1"># setup.apply(pose)</span>
        <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoreing</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add_constraints_from_cmdline_to_pose</span><span class="p">(</span><span class="n">pose</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PyRosettaError"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.PyRosettaError">[docs]</a><span class="k">class</span> <span class="nc">PyRosettaError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="c1"># =========================================================================</span>
<span class="c1">#</span>
<span class="c1"># ExperimentRunner Classes</span>
<span class="c1">#</span>
<span class="c1"># =========================================================================</span>


<div class="viewcode-block" id="MutagenesisExperimentRunner"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutagenesisExperimentRunner">[docs]</a><span class="k">class</span> <span class="nc">MutagenesisExperimentRunner</span><span class="p">(</span><span class="n">AbstractExperimentRunner</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span> <span class="n">rosetta_init_options</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">residue_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">AA_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">nreps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                 <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_pack_rounds</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_restrict_radius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdb_base</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">packer_job_class</span> <span class="o">=</span> <span class="n">MutantddGPackerJob</span>

        <span class="c1"># def __init__(self,start_pose_pdbs,rosetta_init_options,comm,restrict_to_chain=False,max_pack_rounds=25,min_cst_sd=None,min_restrict_radius=False,PDB_res=False,dump_ref_pdb=False,dump_mut_pdb=False,pdb_base=&quot;&quot;,):</span>

        <span class="n">AbstractExperimentRunner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span>
                                          <span class="n">rosetta_init_options</span><span class="p">,</span>
                                          <span class="n">comm</span><span class="p">,</span>
                                          <span class="n">restrict_to_chain</span><span class="o">=</span><span class="n">restrict_to_chain</span><span class="p">,</span>
                                          <span class="n">max_pack_rounds</span><span class="o">=</span><span class="n">max_pack_rounds</span><span class="p">,</span>
                                          <span class="n">min_cst_sd</span><span class="o">=</span><span class="n">min_cst_sd</span><span class="p">,</span>
                                          <span class="n">min_restrict_radius</span><span class="o">=</span><span class="n">min_restrict_radius</span><span class="p">,</span>
                                          <span class="n">PDB_res</span><span class="o">=</span><span class="n">PDB_res</span><span class="p">,</span>
                                          <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="n">dump_ref_pdb</span><span class="p">,</span>
                                          <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="n">dump_mut_pdb</span><span class="p">,</span>
                                          <span class="n">pdb_base</span><span class="o">=</span><span class="n">pdb_base</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                          <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_MPI</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_jobs</span><span class="p">(</span><span class="n">residue_list</span><span class="p">,</span> <span class="n">AA_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">)</span>

<div class="viewcode-block" id="MutagenesisExperimentRunner.setup_jobs"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutagenesisExperimentRunner.setup_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">setup_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residue_list</span><span class="p">,</span> <span class="n">AA_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_list</span><span class="p">(</span><span class="n">residue_list</span><span class="p">,</span> <span class="n">AA_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="MutagenesisExperimentRunner.build_job_list"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutagenesisExperimentRunner.build_job_list">[docs]</a>    <span class="k">def</span> <span class="nf">build_job_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">residues</span><span class="p">,</span> <span class="n">AAs</span><span class="p">,</span> <span class="n">replicates</span><span class="p">,</span> <span class="n">shuffle_jobs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># build job objects for the entire run</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start_pdb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdbs</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">AA</span> <span class="ow">in</span> <span class="n">AAs</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">replicates</span><span class="p">):</span>
                        <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_pdb</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">AA</span><span class="p">,</span> <span class="n">rep</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;+++++++ Sending </span><span class="si">%d</span><span class="s2"> jobs to </span><span class="si">%d</span><span class="s2"> MPI child processes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">shuffle_jobs</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
        <span class="n">job_div</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">job_rem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">job_div</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">job_div_procs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">job_rem</span>

        <span class="n">split_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">job_div</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">job_div_procs</span> <span class="o">*</span> <span class="n">job_div</span><span class="p">,</span> <span class="n">job_div</span><span class="p">)]</span>
        <span class="n">split_jobs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">job_div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">job_div_procs</span> <span class="o">*</span> <span class="n">job_div</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span> <span class="n">job_div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="c1"># if self.verbose &gt;=1:</span>
        <span class="c1">#    print &quot;*********************  n_jobs: %d job_div: %d job_rem: %d&quot; % (len(jobs),job_div,job_rem)</span>
        <span class="c1"># if job_rem &gt; 0:</span>
        <span class="c1">#    split_jobs.append(jobs[-job_rem:])</span>
        <span class="c1">#    print &gt;&gt; sys.stderr,  &quot;*********** split_jobs: %d&quot; % (len(split_jobs),)</span>

        <span class="k">return</span> <span class="n">split_jobs</span></div>

<div class="viewcode-block" id="MutagenesisExperimentRunner.dump_ddg_results"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutagenesisExperimentRunner.dump_ddg_results">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ddg_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump results to a .tsv file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;start_pose_pdb&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;start_pose_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;Pose_residue&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;PDB_residue&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;refAA&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mutAA&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;replicate&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ref_start_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mut_start_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ref_final_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mut_final_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ddG&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;packing_rounds&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;packing_steps&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;minimize_steps&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;run_time&#39;</span><span class="p">]</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;jobID&quot;</span><span class="p">,</span> <span class="s2">&quot;MPI_rank&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">result_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">job_result</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_results</span><span class="p">):</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">),</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">job_result</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result_fields</span><span class="p">])</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">class SecondaryMutantsExperimentRunner(MutagenesisExperimentRunner):</span>

<span class="sd">    def __init__(self,start_pose_pdbs,rosetta_init_options,comm,ref_pdb,center_residue,center_residue_chain,radius,nreps=50,restrict_to_chain=False,max_pack_rounds=25,PDB_res=False,dump_ref_pdb=False,dump_mut_pdb=False,pdb_base=&quot;&quot;):</span>

<span class="sd">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="MutantCombinationsExperimentRunner"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantCombinationsExperimentRunner">[docs]</a><span class="k">class</span> <span class="nc">MutantCombinationsExperimentRunner</span><span class="p">(</span><span class="n">AbstractExperimentRunner</span><span class="p">):</span>
    <span class="c1"># Set up experiment where a list of specific variants (possibly w/ more than one mutation each) are made</span>
    <span class="c1">#</span>
    <span class="c1"># Pass in mutant_list, where each list item is a mutant represented by a list of tuples of the form (residue,AA)</span>
    <span class="c1">#   e.g. to test a mutant with Arg234 -&gt; Ser, Tyr397 -&gt; 3IY we&#39;d do [[(234,&#39;ARG&#39;),(397,&#39;3IY&#39;)],...]</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span> <span class="n">rosetta_init_options</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">mutant_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">nreps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">max_pack_rounds</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_restrict_radius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdb_base</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">packer_job_class</span> <span class="o">=</span> <span class="n">MultiMutantPackerJob</span>
        <span class="c1">#        AbstractExperimentRunner.__init__(self,start_pose_pdbs,rosetta_init_options,restrict_to_chain,max_pack_rounds,min_cst_sd,min_restrict_radius,PDB_res,dump_ref_pdb,dump_mut_pdb,pdb_base)</span>
        <span class="n">AbstractExperimentRunner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span> <span class="n">rosetta_init_options</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
                                          <span class="n">restrict_to_chain</span><span class="o">=</span><span class="n">restrict_to_chain</span><span class="p">,</span> <span class="n">max_pack_rounds</span><span class="o">=</span><span class="n">max_pack_rounds</span><span class="p">,</span>
                                          <span class="n">min_cst_sd</span><span class="o">=</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="n">min_restrict_radius</span><span class="o">=</span><span class="n">min_restrict_radius</span><span class="p">,</span>
                                          <span class="n">PDB_res</span><span class="o">=</span><span class="n">PDB_res</span><span class="p">,</span> <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="n">dump_ref_pdb</span><span class="p">,</span> <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="n">dump_mut_pdb</span><span class="p">,</span>
                                          <span class="n">pdb_base</span><span class="o">=</span><span class="n">pdb_base</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_MPI</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_jobs</span><span class="p">(</span><span class="n">mutant_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">)</span>

<div class="viewcode-block" id="MutantCombinationsExperimentRunner.setup_jobs"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantCombinationsExperimentRunner.setup_jobs">[docs]</a>    <span class="k">def</span> <span class="nf">setup_jobs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutant_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_job_list</span><span class="p">(</span><span class="n">mutant_list</span><span class="p">,</span> <span class="n">nreps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">jobs</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">final_results</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="MutantCombinationsExperimentRunner.build_job_list"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantCombinationsExperimentRunner.build_job_list">[docs]</a>    <span class="k">def</span> <span class="nf">build_job_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mutant_list</span><span class="p">,</span> <span class="n">replicates</span><span class="p">,</span> <span class="n">shuffle_jobs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="c1"># build job objects for the entire run</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start_pdb</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdbs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">mutant</span> <span class="ow">in</span> <span class="n">mutant_list</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">replicates</span><span class="p">):</span>
                    <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start_pdb</span><span class="p">,</span> <span class="n">mutant</span><span class="p">,</span> <span class="n">rep</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;+++++++ Sending </span><span class="si">%d</span><span class="s2"> jobs to </span><span class="si">%d</span><span class="s2"> MPI child processes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">shuffle_jobs</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
        <span class="n">job_div</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="n">job_rem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">job_div</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
        <span class="n">job_div_procs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">job_rem</span>

        <span class="n">split_jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">job_div</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">job_div_procs</span> <span class="o">*</span> <span class="n">job_div</span><span class="p">,</span> <span class="n">job_div</span><span class="p">)]</span>
        <span class="n">split_jobs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">job_div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">job_div_procs</span> <span class="o">*</span> <span class="n">job_div</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span> <span class="n">job_div</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;*********************  n_jobs: </span><span class="si">%d</span><span class="s2"> job_div: </span><span class="si">%d</span><span class="s2"> job_rem: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span> <span class="n">job_div</span><span class="p">,</span> <span class="n">job_rem</span><span class="p">)</span>
            <span class="c1"># if job_rem &gt; 0:</span>
            <span class="c1">#    split_jobs.append(jobs[-job_rem:])</span>

            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;*********** split_jobs: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_jobs</span><span class="p">),)</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">split_jobs</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">split_jobs</span></div>

<div class="viewcode-block" id="MutantCombinationsExperimentRunner.dump_ddg_results"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantCombinationsExperimentRunner.dump_ddg_results">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ddg_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile_name</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dump results to a .tsv file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;start_pose_pdb&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;start_pose_name&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mutation_list&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;replicate&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ref_start_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mut_start_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ref_final_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;mut_final_score&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;ddG&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;packing_rounds&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;packing_steps&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;minimize_steps&#39;</span><span class="p">,</span>
                         <span class="s1">&#39;run_time&#39;</span><span class="p">]</span>

        <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">outfile_name</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;jobID&quot;</span><span class="p">,</span> <span class="s2">&quot;MPI_rank&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">result_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">job_result</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">final_results</span><span class="p">):</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">outfile</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">),</span> <span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">job_result</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result_fields</span><span class="p">])</span>
        <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="SecondaryMutantScanExperimentRunner"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.SecondaryMutantScanExperimentRunner">[docs]</a><span class="k">class</span> <span class="nc">SecondaryMutantScanExperimentRunner</span><span class="p">(</span><span class="n">MutantCombinationsExperimentRunner</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdbs</span><span class="p">,</span> <span class="n">rosetta_init_options</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">center_residue</span><span class="p">,</span> <span class="n">center_residue_AA</span><span class="p">,</span>
                 <span class="n">center_residue_chain</span><span class="p">,</span> <span class="n">mutate_radius</span><span class="p">,</span> <span class="n">center_res_ref_pose</span><span class="p">,</span> <span class="n">mutate_secondary_to_AAs</span><span class="p">,</span> <span class="n">nreps</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                 <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">max_pack_rounds</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_restrict_radius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pdb_base</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="c1"># init so we can compute the residues to mutate; will re-initialize via AbstractExperimentRunner after all class-specific __init__ business is done</span>
        <span class="n">mpi_init</span><span class="p">(</span><span class="n">extra_options</span><span class="o">=</span><span class="n">rosetta_init_options</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">center_res</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_AA</span> <span class="o">=</span> <span class="n">center_residue_AA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_radius</span> <span class="o">=</span> <span class="n">mutate_radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span> <span class="o">=</span> <span class="n">center_residue_chain</span>
        <span class="c1"># Set up to use center residue coordinates from a single pose for consistency for now; could change to pass this off to individual poses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">center_res_ref_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_file</span><span class="p">(</span><span class="n">center_res_ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_secondary_to_AAs</span> <span class="o">=</span> <span class="n">mutate_secondary_to_AAs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="k">if</span> <span class="n">PDB_res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_res_ref_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">pdb2pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span><span class="p">,</span> <span class="n">center_residue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">center_res</span> <span class="o">=</span> <span class="n">center_res</span>

        <span class="n">radius_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue_CAs_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_res_ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_res</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">mutate_radius</span><span class="p">)</span>

        <span class="n">mutant_list</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_AA</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">radius_list</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutate_secondary_to_AAs</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_res</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span> <span class="o">&gt;&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="s2">&quot;SecondaryMutantScanExperimentRunner: radius_list=</span><span class="si">%s</span><span class="s2"> mutant_list=</span><span class="si">%s</span><span class="s2"> center_res_ref_pose=</span><span class="si">%s</span><span class="s2"> center_residue_chain=</span><span class="si">%s</span><span class="s2"> center_res=</span><span class="si">%s</span><span class="s2"> mutate_radius=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">radius_list</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">mutant_list</span><span class="p">),</span> <span class="n">center_res_ref_pose</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_residue_chain</span><span class="p">),</span>
                <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center_res</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutate_radius</span><span class="p">))</span>

        <span class="n">MutantCombinationsExperimentRunner</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                                    <span class="n">start_pose_pdbs</span><span class="p">,</span>
                                                    <span class="n">rosetta_init_options</span><span class="p">,</span>
                                                    <span class="n">comm</span><span class="p">,</span>
                                                    <span class="n">mutant_list</span><span class="o">=</span><span class="n">mutant_list</span><span class="p">,</span>
                                                    <span class="n">nreps</span><span class="o">=</span><span class="n">nreps</span><span class="p">,</span>
                                                    <span class="n">restrict_to_chain</span><span class="o">=</span><span class="n">restrict_to_chain</span><span class="p">,</span>
                                                    <span class="n">max_pack_rounds</span><span class="o">=</span><span class="n">max_pack_rounds</span><span class="p">,</span>
                                                    <span class="n">min_cst_sd</span><span class="o">=</span><span class="n">min_cst_sd</span><span class="p">,</span>
                                                    <span class="n">min_restrict_radius</span><span class="o">=</span><span class="n">min_restrict_radius</span><span class="p">,</span>
                                                    <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                    <span class="n">dump_ref_pdb</span><span class="o">=</span><span class="n">dump_ref_pdb</span><span class="p">,</span>
                                                    <span class="n">dump_mut_pdb</span><span class="o">=</span><span class="n">dump_mut_pdb</span><span class="p">,</span>
                                                    <span class="n">pdb_base</span><span class="o">=</span><span class="n">pdb_base</span><span class="p">,</span>
                                                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

<div class="viewcode-block" id="SecondaryMutantScanExperimentRunner.residue_CAs_in_radius"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.SecondaryMutantScanExperimentRunner.residue_CAs_in_radius">[docs]</a>    <span class="k">def</span> <span class="nf">residue_CAs_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_pose</span><span class="p">,</span> <span class="n">center_chain</span><span class="p">,</span> <span class="n">centerAA</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a list of residues with C-alpha atoms within &#39;radius&#39; distance from centerAA&#39;a C-alpha</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">centerAA_CA</span> <span class="o">=</span> <span class="n">center_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">centerAA</span><span class="p">)</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">)</span>
        <span class="n">repack_residues</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;SecondaryMutantScanExperimentRunner.residue_CA_in_radius: centerAA=</span><span class="si">%d</span><span class="s2">, restrict_to_chain=</span><span class="si">%s</span><span class="s2"> total_res=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">centerAA</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">center_chain</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">center_pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">())))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">center_pose</span><span class="o">.</span><span class="n">total_residue</span><span class="p">()):</span>
            <span class="c1"># This is a little fudgy since restrict_to_chain could be either a list or a string depending on the calling child class</span>
            <span class="c1">#</span>
            <span class="c1"># Note that this may break if chains are not single characters</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">center_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">center_chain</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">test_CA</span> <span class="o">=</span> <span class="n">center_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">xyz</span><span class="p">(</span><span class="s1">&#39;CA&#39;</span><span class="p">)</span>
            <span class="n">displacement</span> <span class="o">=</span> <span class="n">centerAA_CA</span> <span class="o">-</span> <span class="n">test_CA</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">displacement</span><span class="o">.</span><span class="n">norm</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">:</span>
                <span class="n">repack_residues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">repack_residues</span></div></div>


<span class="c1">#        self.packer_job_class = MultiMutantPackerJob</span>
<span class="c1">#        AbstractExperimentRunner.__init__(self,start_pose_pdbs,rosetta_init_options,restrict_to_chain,max_pack_rounds,min_cst_sd,min_restrict_radius,PDB_res,dump_ref_pdb,dump_mut_pdb,pdb_base)</span>
<span class="c1">#        AbstractExperimentRunner.__init__(self,start_pose_pdbs,\</span>
<span class="c1">#                                              rosetta_init_options,\</span>
<span class="c1">#                                              comm,\</span>
<span class="c1">#                                              restrict_to_chain=restrict_to_chain,\</span>
<span class="c1">#                                              max_pack_rounds=max_pack_rounds,\</span>
<span class="c1">#                                              min_cst_sd=min_cst_sd,\</span>
<span class="c1">#                                              min_restrict_radius=min_restrict_radius,\</span>
<span class="c1">#                                              PDB_res=PDB_res,\</span>
<span class="c1">#                                              dump_ref_pdb=dump_ref_pdb,\</span>
<span class="c1">#                                              dump_mut_pdb=dump_mut_pdb,\</span>
<span class="c1">#                                              pdb_base=pdb_base)</span>
<span class="c1">#        self.setup_MPI(comm)</span>
<span class="c1">#        self.setup_jobs(mutant_list,nreps)</span>

<span class="c1"># =========================================================================</span>
<span class="c1">#</span>
<span class="c1"># PackerJob Classes</span>
<span class="c1">#</span>
<span class="c1"># =========================================================================</span>


<div class="viewcode-block" id="MutantddGPackerJob"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantddGPackerJob">[docs]</a><span class="k">class</span> <span class="nc">MutantddGPackerJob</span><span class="p">(</span><span class="n">AbstractPackerJob</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdb</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">AA</span><span class="p">,</span> <span class="n">replicate</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">conv_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repack_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorefn</span><span class="o">=</span><span class="s2">&quot;mm_std&quot;</span><span class="p">,</span>
                 <span class="n">mintype</span><span class="o">=</span><span class="s2">&quot;dfpmin_armijo_nonmonotone&quot;</span><span class="p">,</span> <span class="n">n_pack_steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_min_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_restrict_radius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span> <span class="o">=</span> <span class="n">min_cst_sd</span>
        <span class="c1"># self.constraint_file = constraint_file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span> <span class="o">=</span> <span class="n">min_restrict_radius</span>
        <span class="k">if</span> <span class="n">restrict_to_chain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span>

        <span class="n">AbstractPackerJob</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="p">,</span> <span class="n">conv_threshold</span><span class="p">,</span> <span class="n">repack_radius</span><span class="p">,</span> <span class="n">scorefn</span><span class="p">,</span> <span class="n">mintype</span><span class="p">,</span> <span class="n">max_rounds</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="c1"># Mutant definition - residue to mutate, AA to mutate to, and replicate number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span> <span class="o">=</span> <span class="n">start_pose_pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">start_pose_pdb</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">start_pose_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># GAAAAAAAH Why do they not make these backwards-compatible &gt;8-O!!!</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_pose_in</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">start_pose_in</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">start_pose_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">PDB_res</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">pdb2pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="n">residue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">=</span> <span class="n">residue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AA</span> <span class="o">=</span> <span class="n">AA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicate</span> <span class="o">=</span> <span class="n">replicate</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PyRosettaError</span><span class="p">(</span>
                <span class="s2">&quot;MISSING RESIDUE </span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AA</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span> <span class="o">=</span> <span class="n">n_pack_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span> <span class="o">=</span> <span class="n">n_min_steps</span>

        <span class="c1"># set up starting poses for reference and mutant</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>

        <span class="c1"># set up cst file constraints if specified; not sure about how this interacts w/ coord constraints?</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_scorefxn</span><span class="p">(</span>
                    <span class="n">constraint_types</span><span class="o">=</span><span class="p">[</span><span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">atom_pair_constraint</span><span class="p">,</span>
                                      <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">angle_constraint</span><span class="p">,</span>
                                      <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">dihedral_constraint</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_scorefxn</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="c1"># Add coordinate constraints if specified</span>
        <span class="c1"># Note for future reference that this needs to be done *AFTER* setting file constraints</span>
        <span class="c1"># (loading file constraints apparently deletes any existing constraints?)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">:</span>
            <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add_coordinate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add_coordinate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># This is a hack to deal with chirality problems for some nsAAs when mutating from Glycine</span>
        <span class="c1">#</span>
        <span class="c1">#    Pose.replace_residue() seems to place sidechain correctly</span>
        <span class="c1">#    for ALA, and from any chiral AA to the nsAAs so mutate GLY to ALA first</span>
        <span class="c1"># if  self.start_pose.residue(self.residue).name3() == &quot;GLY&quot;:</span>
        <span class="c1">#    self.mutate_aa(self.ref_pose,self.residue,&quot;ALA&quot;,clone_pose=False)</span>
        <span class="c1">#    self.mutate_aa(self.mut_pose,self.residue,&quot;ALA&quot;,clone_pose=False)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_aa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">)</span><span class="o">.</span><span class="n">name3</span><span class="p">(),</span> <span class="n">clone_pose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutate_aa</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span> <span class="n">clone_pose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Score function and Weights for </span><span class="si">%s</span><span class="s2">:&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Ref Pose:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;Mut Pose:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">))</span>

        <span class="c1"># Store initial pose scores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set up PackerTasks and Movers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_packertask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packer_task_repack_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repack_radius</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_packertask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">packer_task_repack_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repack_radius</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_minmover</span><span class="p">(</span><span class="n">mintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_minmover</span><span class="p">(</span><span class="n">mintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pack_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span>
                                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ref_packertask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pack_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span>
                                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">mut_packertask</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_CompoundMover</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pack_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_mover</span><span class="p">],</span>
                                                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_CompoundMover</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pack_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_mover</span><span class="p">],</span>
                                                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Keep track of where we are in the run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MutantddGPackerJob.run"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantddGPackerJob.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Grab the score function from w/t TrialMover object</span>
        <span class="c1"># Might want to check that same as mut score fxn in the future</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">)))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rounds</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ROUND </span><span class="si">%d</span><span class="s2"> SCORES: w/t: </span><span class="si">%f</span><span class="s2"> Mut: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;=======================&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> FINAL SCORE: w/t: </span><span class="si">%f</span><span class="s2">  Mut: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span><span class="p">))</span>
        <span class="c1"># print &quot;ACCEPTED: w/t: %f  Mut: %f&quot; % (self.ref_mover.num_accepts(),self.mut_mover.num_accepts())</span>
        <span class="c1"># return (wt_pose,mut_pose)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span></div>

<div class="viewcode-block" id="MutantddGPackerJob.get_result"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantddGPackerJob.get_result">[docs]</a>    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start_pose_pdb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">,</span>
                       <span class="s1">&#39;start_pose_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_name</span><span class="p">,</span>
                       <span class="s1">&#39;Pose_residue&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">,</span>
                       <span class="s1">&#39;PDB_residue&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">pose2pdb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">),</span>
                       <span class="s1">&#39;refAA&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue</span><span class="p">)</span><span class="o">.</span><span class="n">name3</span><span class="p">(),</span>
                       <span class="s1">&#39;mutAA&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">AA</span><span class="p">,</span>
                       <span class="s1">&#39;replicate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicate</span><span class="p">,</span>
                       <span class="s1">&#39;ref_start_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_start_score</span><span class="p">,</span>
                       <span class="s1">&#39;mut_start_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_start_score</span><span class="p">,</span>
                       <span class="s1">&#39;ref_final_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span><span class="p">,</span>
                       <span class="s1">&#39;mut_final_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span><span class="p">,</span>
                       <span class="s1">&#39;ddG&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span><span class="p">,</span>
                       <span class="s1">&#39;packing_rounds&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">,</span>
                       <span class="s1">&#39;packing_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span>
                       <span class="s1">&#39;minimize_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">,</span>
                       <span class="s1">&#39;run_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">result_dict</span></div>

<div class="viewcode-block" id="MutantddGPackerJob.dump_ref_pdb"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantddGPackerJob.dump_ref_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ref_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="MutantddGPackerJob.dump_mut_pdb"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MutantddGPackerJob.dump_mut_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">dump_mut_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="MultiMutantPackerJob"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob">[docs]</a><span class="k">class</span> <span class="nc">MultiMutantPackerJob</span><span class="p">(</span><span class="n">AbstractPackerJob</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_pose_pdb</span><span class="p">,</span> <span class="n">mutation_list</span><span class="p">,</span> <span class="n">replicate</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">conv_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repack_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorefn</span><span class="o">=</span><span class="s2">&quot;mm_std&quot;</span><span class="p">,</span>
                 <span class="n">mintype</span><span class="o">=</span><span class="s2">&quot;dfpmin_armijo_nonmonotone&quot;</span><span class="p">,</span> <span class="n">n_pack_steps</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">n_min_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_cst_sd</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">min_restrict_radius</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">PDB_res</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="c1"># self.chain = chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutation_list</span> <span class="o">=</span> <span class="n">mutation_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span> <span class="o">=</span> <span class="n">min_cst_sd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span> <span class="o">=</span> <span class="n">min_restrict_radius</span>
        <span class="k">if</span> <span class="n">restrict_to_chain</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">mutation_list</span><span class="p">]</span>

        <span class="c1"># print &gt;&gt; sys.stderr, &quot;MultiMutantPackerJob __init__(): mutation_list=%s restrict_to_chain=%s restrict_packing_to_chain=%s&quot; % (str(self.mutation_list),str(restrict_to_chain),str(self.restrict_packing_to_chain))</span>

        <span class="n">AbstractPackerJob</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="o">=</span><span class="n">convergence_fn</span><span class="p">,</span>
                                   <span class="n">conv_threshold</span><span class="o">=</span><span class="n">conv_threshold</span><span class="p">,</span>
                                   <span class="n">repack_radius</span><span class="o">=</span><span class="n">repack_radius</span><span class="p">,</span>
                                   <span class="n">scorefn</span><span class="o">=</span><span class="n">scorefn</span><span class="p">,</span>
                                   <span class="n">mintype</span><span class="o">=</span><span class="n">mintype</span><span class="p">,</span>
                                   <span class="n">max_rounds</span><span class="o">=</span><span class="n">max_rounds</span><span class="p">,</span>
                                   <span class="n">restrict_to_chain</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">restrict_packing_to_chain</span><span class="p">,</span>
                                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                   <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="c1"># Mutant definition - residue to mutate, AA to mutate to, and replicate number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span> <span class="o">=</span> <span class="n">start_pose_pdb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">start_pose_pdb</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">start_pose_in</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">start_pose_in</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pdb_res</span> <span class="o">=</span> <span class="n">PDB_res</span>

        <span class="c1"># self.residue = None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span> <span class="o">=</span> <span class="n">n_pack_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span> <span class="o">=</span> <span class="n">n_min_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replicate</span> <span class="o">=</span> <span class="n">replicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_poses</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_scorefxn</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="c1"># Store initial pose scores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_minmover</span><span class="p">(</span><span class="n">mintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_minmover</span><span class="p">(</span><span class="n">mintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pack_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span>
                                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">ref_packertask</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pack_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span>
                                                                                         <span class="bp">self</span><span class="o">.</span><span class="n">mut_packertask</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_CompoundMover</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pack_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_mover</span><span class="p">],</span>
                                                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_CompoundMover</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pack_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_mover</span><span class="p">],</span>
                                                 <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Keep track of where we are in the run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MultiMutantPackerJob.setup_poses"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob.setup_poses">[docs]</a>    <span class="k">def</span> <span class="nf">setup_poses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">repr_str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="n">cur_ref_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="n">cur_ref_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>
        <span class="n">cur_mut_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="n">cur_mut_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="p">)</span>

        <span class="n">pack_residues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">residue</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">AA</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutation_list</span><span class="p">:</span>

            <span class="c1"># print &gt;&gt; sys.stderr, &quot;====&gt; RESIDUE IN: %s, %d, %s, %s, PDB_res?:%s&quot; % (self.start_pose.residue(residue).name(),residue,chain,AA,str(self.pdb_res))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdb_res</span><span class="p">:</span>
                <span class="n">residue</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">pdb_info</span><span class="p">()</span><span class="o">.</span><span class="n">pdb2pose</span><span class="p">(</span><span class="n">chain</span><span class="p">,</span> <span class="n">residue</span><span class="p">)</span>
            <span class="c1"># print &gt;&gt; sys.stderr, &quot;====&gt; RESIDUE RESULT: %s, %d, %s, %s, PDB_res?:%s&quot; % (self.start_pose.residue(residue).name(),residue,chain,AA,str(self.pdb_res))</span>

            <span class="k">if</span> <span class="n">residue</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PyRosettaError</span><span class="p">(</span><span class="s2">&quot;MISSING RESIDUE </span><span class="si">%s</span><span class="s2"> </span><span class="si">%d</span><span class="s2"> </span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">AA</span><span class="p">))</span>

            <span class="n">repr_str</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_</span><span class="si">%d</span><span class="s2">_</span><span class="si">%s</span><span class="s2">-&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">residue</span><span class="p">,</span> <span class="n">AA</span><span class="p">)</span>
            <span class="n">cur_ref_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutate_aa</span><span class="p">(</span><span class="n">cur_ref_pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">cur_ref_pose</span><span class="o">.</span><span class="n">residue</span><span class="p">(</span><span class="n">residue</span><span class="p">)</span><span class="o">.</span><span class="n">name3</span><span class="p">()))</span>
            <span class="n">cur_mut_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutate_aa</span><span class="p">(</span><span class="n">cur_mut_pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="n">AA</span><span class="p">))</span>

            <span class="n">pack_residues</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residue_CAs_in_radius</span><span class="p">(</span><span class="n">cur_ref_pose</span><span class="p">,</span> <span class="n">residue</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">repack_radius</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span> <span class="o">=</span> <span class="n">repr_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;;r</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">replicate</span><span class="p">,)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_str</span> <span class="o">=</span> <span class="n">repr_str</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cur_ref_pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">cur_mut_pose</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">:</span>
            <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add_coordinate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">add_coordinate_constraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_cst_sd</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Set up PackerTasks and Movers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_packertask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_packer_task_with_residues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="n">pack_residues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_packertask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_packer_task_with_residues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="n">pack_residues</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_restrict_radius</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">,</span> <span class="n">restrict_residues</span><span class="o">=</span><span class="n">pack_residues</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">,</span> <span class="n">restrict_residues</span><span class="o">=</span><span class="n">pack_residues</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_min_movemap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiMutantPackerJob.run"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Grab the score function from w/t TrialMover object</span>
        <span class="c1"># Might want to check that same as mut score fxn in the future</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">started</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">)))</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rounds</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mut_mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">))</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ROUND </span><span class="si">%d</span><span class="s2"> SCORES: w/t: </span><span class="si">%f</span><span class="s2"> Mut: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_trialmover_scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;=======================&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> FINAL SCORE: w/t: </span><span class="si">%f</span><span class="s2">  Mut: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repr_str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span><span class="p">))</span>
        <span class="c1"># print &quot;ACCEPTED: w/t: %f  Mut: %f&quot; % (self.ref_mover.num_accepts(),self.mut_mover.num_accepts())</span>
        <span class="c1"># return (wt_pose,mut_pose)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiMutantPackerJob.get_result"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob.get_result">[docs]</a>    <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;start_pose_pdb&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_pdb</span><span class="p">,</span>
                       <span class="s1">&#39;start_pose_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_pose_name</span><span class="p">,</span>
                       <span class="s1">&#39;mutation_list&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_str</span><span class="p">,</span>
                       <span class="s1">&#39;replicate&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">replicate</span><span class="p">,</span>
                       <span class="s1">&#39;ref_start_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_start_score</span><span class="p">,</span>
                       <span class="s1">&#39;mut_start_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_start_score</span><span class="p">,</span>
                       <span class="s1">&#39;ref_final_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_final_score</span><span class="p">,</span>
                       <span class="s1">&#39;mut_final_score&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mut_final_score</span><span class="p">,</span>
                       <span class="s1">&#39;ddG&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ddG</span><span class="p">,</span>
                       <span class="s1">&#39;packing_rounds&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">,</span>
                       <span class="s1">&#39;packing_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span>
                       <span class="s1">&#39;minimize_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">,</span>
                       <span class="s1">&#39;run_time&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_time</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">result_dict</span></div>

<div class="viewcode-block" id="MultiMutantPackerJob.dump_ref_pdb"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob.dump_ref_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">dump_ref_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ref_pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="MultiMutantPackerJob.dump_mut_pdb"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.MultiMutantPackerJob.dump_mut_pdb">[docs]</a>    <span class="k">def</span> <span class="nf">dump_mut_pdb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mut_pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PackSinglePoseJob"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.PackSinglePoseJob">[docs]</a><span class="k">class</span> <span class="nc">PackSinglePoseJob</span><span class="p">(</span><span class="n">AbstractPackerJob</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_pdb</span><span class="p">,</span> <span class="n">MPI_rank</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">conv_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">repack_radius</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scorefn</span><span class="o">=</span><span class="s2">&quot;mm_std&quot;</span><span class="p">,</span>
                 <span class="n">mintype</span><span class="o">=</span><span class="s2">&quot;dfpmin_armijo_nonmonotone&quot;</span><span class="p">,</span> <span class="n">n_pack_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_min_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_rounds</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">MCmover</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">AbstractPackerJob</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">convergence_fn</span><span class="p">,</span> <span class="n">conv_threshold</span><span class="p">,</span> <span class="n">repack_radius</span><span class="p">,</span> <span class="n">scorefn</span><span class="p">,</span> <span class="n">mintype</span><span class="p">,</span> <span class="n">max_rounds</span><span class="p">,</span>
                                   <span class="n">restrict_to_chain</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">in_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_file</span><span class="p">(</span><span class="n">in_pdb</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">in_pose</span> <span class="o">=</span> <span class="n">rosetta</span><span class="o">.</span><span class="n">pose_from_pdb</span><span class="p">(</span><span class="n">in_pdb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kT</span> <span class="o">=</span> <span class="n">kT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">in_pose</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_scorefxn</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">),</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">MPI_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span> <span class="o">=</span> <span class="n">n_pack_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span> <span class="o">=</span> <span class="n">n_min_steps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">min_mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_minmover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mintype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packer_task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_packer_task_with_residues</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mover</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">MCmover</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_packmin_mover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">packer_task</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">,</span> <span class="n">kT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kT</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pack_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">simple_moves</span><span class="o">.</span><span class="n">PackRotamersMover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">packer_task</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mover</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_CompoundMover</span><span class="p">([</span><span class="n">pack_mover</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_mover</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pack_steps</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_min_steps</span><span class="p">])</span>

<div class="viewcode-block" id="PackSinglePoseJob.pack_pose"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.PackSinglePoseJob.pack_pose">[docs]</a>    <span class="k">def</span> <span class="nf">pack_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;============ Packing Pose Beginning, proccess </span><span class="si">%d</span><span class="s2"> ===========&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;STARTING SCORE: </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">while</span> <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">cnv_fn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_rounds</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Applying Mover in process </span><span class="si">%d</span><span class="s2">, round </span><span class="si">%d</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">))</span>
            <span class="c1"># print seqmover</span>
            <span class="c1"># print trialmover</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;round </span><span class="si">%d</span><span class="s2"> score: </span><span class="si">%f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnd</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnd</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;============ Pose Finished, process </span><span class="si">%d</span><span class="s2"> ===========&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;FINAL SCORE: </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scores</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span></div>

    <span class="c1">#</span>
<div class="viewcode-block" id="PackSinglePoseJob.dump_pose"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.PackSinglePoseJob.dump_pose">[docs]</a>    <span class="k">def</span> <span class="nf">dump_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="FastRelaxPoseJob"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.FastRelaxPoseJob">[docs]</a><span class="k">class</span> <span class="nc">FastRelaxPoseJob</span><span class="p">(</span><span class="n">AbstractPackerJob</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_pdb</span><span class="p">,</span> <span class="n">MPI_rank</span><span class="p">,</span> <span class="n">scorefn</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">constraint_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="n">AbstractPackerJob</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scorefn</span><span class="o">=</span><span class="n">scorefn</span><span class="p">,</span> <span class="n">restrict_to_chain</span><span class="o">=</span><span class="n">restrict_to_chain</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                   <span class="n">constraint_file</span><span class="o">=</span><span class="n">constraint_file</span><span class="p">)</span>

        <span class="n">in_pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">pose_from_file</span><span class="p">(</span><span class="n">in_pdb</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">Pose</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">in_pose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_scorefxn</span><span class="p">(</span>
                <span class="n">constraint_types</span><span class="o">=</span><span class="p">[</span><span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">atom_pair_constraint</span><span class="p">,</span>
                                  <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">angle_constraint</span><span class="p">,</span>
                                  <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">scoring</span><span class="o">.</span><span class="n">constraints</span><span class="o">.</span><span class="n">dihedral_constraint</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_constraints_to_pose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">constraint_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rank</span> <span class="o">=</span> <span class="n">MPI_rank</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rlx_mover</span> <span class="o">=</span> <span class="n">pyrosetta</span><span class="o">.</span><span class="n">rosetta</span><span class="o">.</span><span class="n">protocols</span><span class="o">.</span><span class="n">relax</span><span class="o">.</span><span class="n">FastRelax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rlx_mover</span><span class="o">.</span><span class="n">set_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">build_movemap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_score</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="FastRelaxPoseJob.pack_pose"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.FastRelaxPoseJob.pack_pose">[docs]</a>    <span class="k">def</span> <span class="nf">pack_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;============ Packing Pose Beginning, proccess </span><span class="si">%d</span><span class="s2"> ===========&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;STARTING SCORE: </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rlx_mover</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;============ Pose Finished, process </span><span class="si">%d</span><span class="s2"> ===========&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rank</span><span class="p">,))</span>
            <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;FINAL SCORE: </span><span class="si">%f</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scorefn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="p">)</span></div>

<div class="viewcode-block" id="FastRelaxPoseJob.dump_pose"><a class="viewcode-back" href="../PyRosetta_TACC_MPI.html#PyRosetta_TACC_MPI.FastRelaxPoseJob.dump_pose">[docs]</a>    <span class="k">def</span> <span class="nf">dump_pose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfile</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pose</span><span class="o">.</span><span class="n">dump_pdb</span><span class="p">(</span><span class="n">outfile</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">_main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Bioinfo Nats</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Pierre Bedoucha.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.1.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>